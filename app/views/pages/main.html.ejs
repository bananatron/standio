<!DOCTYPE html>
<html>
  <head>
    <link href='https://fonts.googleapis.com/css?family=Quicksand:300,400,700' rel='stylesheet' type='text/css'>
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">-->
    
    <title>STAND.IO</title>
    <link rel="stylesheet" href="/stylesheets/screen.css" />
    <link rel="stylesheet" href="/stylesheets/sweet-alert.css" />
  </head>
  <body>
    <div id="header">
      <h1><a href="/">STAND.IO</a></h1>
         <br>
      <fonrm><input placeholder="WHO IS YOU?" id="form_user" /></form><br><br>
      <div id="date_controls"> 
        <a href="/date/<%= mm %>/<%= parseInt(dd)-1 %>/<%= yyyy %>">⟵</a> 
        <span id="form_date"><%= mm %>/<%= dd %>/<%= yyyy %></span>
        <a href="/date/<%= mm %>/<%= parseInt(dd)+1 %>/<%= yyyy %>">⟶</a> 
      </div>
    </div>
    
    <% for (var i = 0; i <= end_hour-start_hour; i++) { 
      var current_time = i+start_hour
      console.log(current_time)
    %>
     <div id="hour_<%= current_time %>" class="slot"> 
       <div class="timestamp">
       <% if (current_time < 13){ %> <%= current_time %> <% if (current_time == 12){ %>PM<%}else {%>AM<%} %> 
       <% } else {%> <%= current_time-12 %> PM <%}%></div>
       
       
       
       
       <div class="booked_by"><%= day_array[i] %></div>
       
       
       
       
       
       
       <div class="actions"><a class="write-link action-links" href="/write/<%=current_time%>/_user_/_date_">BOOK</a><br>
       <a class="action-links cancel-link" href="/cancel/<%=current_time%>/_user_/_date_">CANCEL</a></div>

     </div>
    <% } %>
    
    <br><br>

  </body>
</html>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="/javascript/sweet-alert.min.js"></script>
<script src="javascript/main.js"></script>
  <script>
    $( document ).ready(function() {
      console.log( "dom ready - jquery live!" );
      
      $( ".write-link" ).click(function(link) {
        var form_user = $("#form_user").val();

        if (form_user == ""){ 
          sweetAlert("Hey there buddy", "You need to put your name in.", "error"); 
          link.preventDefault();
        } else {
        
          //this.match('write/:hour/:user/:date' (Date in format of 10_10_1988)
          var a_href = ($(this).attr('href'));

          var form_date = $("#form_date").text().replace( /([/])/g, "_" );

          var new_href = a_href.replace( "_user_", form_user ) ;
          var new_href = new_href.replace( "_date_", form_date ) ;
          //var final_href = a_href.replace( "_date_", new_date );
          //sweetAlert(new_href);
          $(this).attr("href", new_href)
          //link.preventDefault();
        }
      });
      
      $( ".cancel-link" ).click(function(link) {
        var form_user = $(this).parent().parent().children( ".booked_by" ).text();
        
        if (form_user == "OPEN"){ 
          sweetAlert("Whoah nelly!", "You can't cancel an open slot.", "error"); 
          link.preventDefault();
        } else {
        
          //this.match('write/:hour/:user/:date' (Date in format of 10_10_1988)
          var a_href = ($(this).attr('href'));

          var form_date = $("#form_date").text().replace( /([/])/g, "_" );

          var new_href = a_href.replace( "_user_", form_user ) ;
          var new_href = new_href.replace( "_date_", form_date ) ;
          //var final_href = a_href.replace( "_date_", new_date );
          //sweetAlert(new_href);
          $(this).attr("href", new_href)
          
        }
      });

    });

</script>